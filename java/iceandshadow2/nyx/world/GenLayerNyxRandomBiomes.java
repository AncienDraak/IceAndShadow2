package iceandshadow2.nyx.world;

import iceandshadow2.nyx.world.biome.NyxBiome;
import net.minecraft.world.biome.BiomeGenBase;
import net.minecraft.world.gen.layer.GenLayer;
import net.minecraft.world.gen.layer.IntCache;

public class GenLayerNyxRandomBiomes extends GenLayer {
	/** This sets all the biomes that are allowed to appear in a dimension */
	private final BiomeGenBase[] allowedBiomes;

	public GenLayerNyxRandomBiomes(BiomeGenBase[] biomes, long par1) {
		super(par1);
		this.allowedBiomes = biomes;
	}

	/**
	 * Returns a list of integer values generated by this layer. These may be
	 * interpreted as temperatures, rainfall amounts, or biomeList[] indices
	 * based on the particular GenLayer subclass.
	 */
	@Override
	public int[] getInts(int x, int z, int xlim, int zlim) {
		final int[] var6 = IntCache.getIntCache(xlim * zlim);

		for (int zit = 0; zit < zlim; ++zit) {
			for (int xit = 0; xit < xlim; ++xit) {
				int xc = xit + x;
				int zc = zit + z;
				this.initChunkSeed(xc, zc);
				int nb = this.nextInt(this.allowedBiomes.length);
				if (this.allowedBiomes[nb] instanceof NyxBiome
						&& ((NyxBiome) this.allowedBiomes[nb]).isRare()) {
					double dist = Math.sqrt(xc*xc + zc*zc);
					if(dist < 96)
						nb = this.allowedBiomes[0].biomeID;
					else if(dist < 512)
						nb = this.nextInt(this.allowedBiomes.length);
				}
				var6[xit + zit * xlim] = this.allowedBiomes[nb].biomeID;
			}
		}

		return var6;
	}
}
